<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:local="clr-namespace:Feleves_feladat"
             xmlns:models="clr-namespace:Feleves_feladat.Models"
             x:Class="Feleves_feladat.WorkoutPage"
             x:DataType="local:WorkoutPageViewModel"
             Title="WorkoutPage">
    <ContentPage.Resources>
        <local:ExerciseSetsAndRepsConverter x:Key="SetXRepsConv"/>
    </ContentPage.Resources>
    <Grid RowDefinitions="Auto, *"
          BackgroundColor="{StaticResource PrimaryColor}">
        <Label
            Text="{Binding PerformedWorkout.Name}"
            FontSize="24"
            FontAttributes="Bold"
            HeightRequest="50"
            HorizontalOptions="Fill"
            HorizontalTextAlignment="Center"
            VerticalTextAlignment="Center"
            BackgroundColor="{Binding PerformedWorkout.Color}"
            TextColor="White"/>
        <ScrollView Grid.Row="1" Margin="0, 0, 0, 0" Padding="3, 0, 3, 0">
            <Grid RowDefinitions="Auto, *">
                    <CollectionView
                        Grid.Row="0"
                        ItemsSource="{Binding PerformedWorkout.Exercises}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Exercise">
                                <Border
                                    Margin="0,5,0,0"
                                    Padding="10"
                                    HeightRequest="140"
                                    StrokeShape="RoundRectangle 5"
                                    BackgroundColor="{StaticResource ThirdColor}">
                                <Border.Triggers>
                                    <DataTrigger
                                        TargetType="Border"
                                        Binding="{Binding IsDone}"
                                        Value="True">
                                        <Setter Property="BackgroundColor" Value="LightGreen"/>
                                        <Setter Property="Opacity" Value="0.7"/>
                                    </DataTrigger>
                                </Border.Triggers>
                                <Grid ColumnDefinitions="Auto,*,Auto"
                                      RowDefinitions="Auto,Auto,*">
                                    <Label
                                        Grid.Column="0"
                                        Text="{Binding Name}"
                                        FontAttributes="Bold"
                                        FontSize="20"
                                        HorizontalOptions="Fill"
                                        HorizontalTextAlignment="Start"/>
                                    <Label 
                                        Grid.Column="2"
                                        Text="{Binding Intensity}"/>
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Text="{Binding ., Converter={StaticResource SetXRepsConv}}"/>
                                    <CollectionView
                                        Grid.Row="2"
                                        Grid.RowSpan="2"
                                        ItemsSource="{Binding PerformedSets}">
                                        <CollectionView.ItemTemplate>
                                            <DataTemplate x:DataType="models:PerformedSet">
                                                <HorizontalStackLayout>
                                                    <Entry Text="{Binding RepCount}" 
                                                           Placeholder="{Binding RepCount}"
                                                           HeightRequest="30"
                                                           WidthRequest="40"
                                                       
                                                           Keyboard="Numeric"
                                                           PlaceholderColor="Black"
                                                           TextColor="Black"
                                                           BackgroundColor="{StaticResource SecondaryColor}"/>
                                                    <Entry Text="{Binding RepsInReserve}"
                                                           Placeholder="{Binding RepsInReserve}"
                                                           HeightRequest="30"
                                                           WidthRequest="40"
                                                           Keyboard="Numeric"
                                                           PlaceholderColor="Black"
                                                           TextColor="Black"
                                                        />
                                                </HorizontalStackLayout>
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                        <CollectionView.ItemsLayout>
                                            <LinearItemsLayout Orientation="Horizontal"
                                                               ItemSpacing="5"/>
                                        </CollectionView.ItemsLayout>
                                    </CollectionView>
                                    <Button
                                        Text="Done"
                                        Command="{Binding Path=BindingContext.ExerciseIsDoneCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                        CommandParameter="{Binding .}"
                                        Padding="0"
                                        Grid.Row="2"
                                        Grid.Column="2"
                                        HeightRequest="30"
                                        WidthRequest="60"
                                        HorizontalOptions="End"
                                        Margin="0,0,0,5"
                                        BackgroundColor="{StaticResource FourthColor}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                <VerticalStackLayout Grid.Row="1">
                    <Button
                        ImageSource="camera_solid_full.png"
                        HeightRequest="70"
                        Margin="0,5,0,5"
                        Command="{Binding TakePictureCommand}"
                        IsVisible="{Binding DoesntHaveImageYet}"
                        BackgroundColor="{StaticResource FourthColor}"
                        />
                    <Button
                        Text="Cancel"
                        HeightRequest="70"
                        Margin="0,5,0,5"
                        Command="{Binding WorkoutCanceledCommand}"
                        BackgroundColor="{StaticResource FourthColor}"
                        />
                    <Image
                        Source="{Binding PerformedWorkout.ImageUrl}"
                        WidthRequest="200"
                        HeightRequest="200"
                        IsVisible="{Binding PerformedWorkout.HasImage}"/>
                    <Button
                        Text="Done"
                        HeightRequest="70"
                        Margin="0,5,0,5"
                        Command="{Binding WorkoutFinishedCommand}"
                        IsVisible="{Binding AllExercisesDone}"
                        BackgroundColor="{StaticResource FourthColor}"
                        />
                </VerticalStackLayout>
            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>